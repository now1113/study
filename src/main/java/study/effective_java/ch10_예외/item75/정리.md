:trophy: 이펙티브 자바 스터디 - 아이템 75

:book: 아이템 75: 예외의 상세 메시지에 실패 관련 정보를 담으라

## 핵심
- 사후 분석을 위해 **실패 순간의 상황을 정확히 포착해 예외의 상세 메시지에 담아야 한다.**
- **실패 순간을 포착하려면 발생한 예외에 관련된 모든 매개변수와 필드의 값을 실패 메시지에 담아야 한다.**
  - 관련 데이터를 모두 담아야 하지만 **장황할 필요는 없다.**
- 보안과 관련된 정보(비밀번호, 토큰, 주민번호 등)는 **절대 예외 메시지에 노출하면 안된다.**

정리하자면
1. 예외 타입 + 스택 트레이스만으로는 부족하다
2. **어떤 입력과 상태에서 실패했는지**를 메시지에 찍어 두어야
3. 로그만으로 **원인 분석 + 재현**이 가능해진다
4. 단, 민감 정보는 절대 포함하지 않는다.

## 왜 상세 메시지가 중요할까
- 하나의 예외 타입(`IndexOutOfBoundsException`, `IllegalArgumentException` 등) 안에 여러가지 원인들이 뒤섞여 있을 수 있다.
- 로그를 봤을 때,
  - 인덱스가 음수인지
  - 범위를 초과했는지
  - 사이즈 계산 로직이 잘못됐는지
  - 이런 **이상의 현상들은 모두 원인이 다르므로, 현상을 보면 무엇을 고쳐야 할지를 분석하는데 큰 도움이 된다.**

## 예외 메시지 vs 사용자에게 보여줄 메시지
- **예외의 상세 메시지**와 **최종 사용자에게 보여줄 오류 메시지**를 혼동하면 안 된다.
- 예외 메시지
  - 개발자/운영자가 보는 것
  - **가독성보다는 얼마나 많은 유용한 정보를 담고 있느냐가 중요**
- 사용자 메시지
  - 일반 사용자가 보는 것
  - 친절하고 이해하기 쉬운 문장, 보안/내부 정보 노출 금지

### 예시
- 예외 메시지(로그용)
```text
Order cannot be canceled. orderNo=O20251124-0001, currentStatus=SHIPPED, requestedStatus=CANCEL_REQUESTED, requestedBy=U12345
```
- 사용자 메시지(화면용)
```text
이미 배송이 시작된 주문은 취소할 수 없습니다. 자세한 문의는 고객센터로 연락해주세요.
```

## 예외에 접근자 메서드를 두는 이유
예외는 실패와 관련한 정보를 얻을 수 있는 **접근자 메서드를 적절히 제공하는 것이 좋다.**  
포착한 실패 정보는 예외 상황을 복구하는데 유용할 수 있으므로  
접근자 메서드는 **비검사 예외보다는 검사 예외에서 더 빛을 발한다.**

### 왜 접근자가 필요할까
- 문자열 메시지 안에만 정보를 넣어두면
  - 재사용/검증이 어렵고
  - 프로그램이 메시지를 파싱해야 하는 등 구조가 깨진다.
- 그래서 예외 객체 안에 **필드 + getter**를 두고,
  - 메시지는 사람이 읽기 좋게
  - 필드는 코드가 다루기 좋게
  - 둘 다 제공하는 방식이 이상적이다.

### 특히 검사 예외에서 더 유용한 이유
- **검사 예외(checked)** 는 호출 측에서 반드시 처리해야 하므로
  - 예외 객체에서 추가 정보를 뽑아서
  - **재시도, 대체 경로 선택, 보정 로직** 등 복구 전략을 세울 수 있다.
- 이 때 `getFailingValue()`, `getExpectedRangeStart()`, `getExpectedRangeEnd()` 같은 접근자가 있으면 코드가 훨씬 깔끔해진다.

## 예외 메시지에 담아야 할 정보들

### 실패에 관여한 모든 매개변수와 필드
- 관여된 모든 매개변수와 필드값을 메시지에 담으라는 말은
  - 그 상황을 **재현할 수 있을 만큼**의 정보를 넣으라는 의미다.
- 하지만 **장황하게 소설을 쓰라는 뜻은 아니다.**
  - 핵심 키/상태만 압축해서 담으면 된다.

```text
Index out of range. index=10, size=5
Order cannot be canceled. orderNo=O20251124-0001, currentStatus=SHIPPED, requestedBy=U12345
quantity(100) exceeds available stock(42), itemId=I-2025-0001
```

### 보안/개인정보는 예외 메시지에 금지
- 비밀번호, 토큰, 주민번호 같은 보안 관련 정보는 **절대 예외 메시지에 노출하면 안 된다.**
- 그 외에도
  - 신용카드 번호 전체
  - 계좌번호 전체
  - JWT 전체
  - 등은 절대 찍지 않아야 한다.

## 예시

### 나쁜 예
```java
throw new IllegalArgumentException("잘못된 인자입니다.");
```
- 어디서, 어떤 값이 잘못됐는지 알 수 없다.

```java
throw new IndexOutOfBoundsException();
```
- 인덱스인지, 범위인지, 길이인지 아무 정보도 없다


### 좋은 예
```java
throw new IllegalArgumentException(
        "quantity(" + quantity + ") must be between 1 and " + maxQuantity
);
```
```java
throw new IndexOutOfBoundsException(
        "index: " + index + ", size: " + size
);
```
이렇게 하면
- quantity를 0이나 너무 큰 값으로 넘겼구나
- 길이가 5인데 index를 10으로 요청했네 
- 를 로그만 보고 알 수 있다.