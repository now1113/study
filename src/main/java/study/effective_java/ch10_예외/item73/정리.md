:trophy: 이펙티브 자바 스터디 - 아이템 73

:book: 아이템 73: 추상화 수준에 맞는 예외를 던지라

## 핵심
- **메서드가 제공하는 추상화 수준에 어울리는 예외를 던지자.**
- 내부 구현(하위 계층)의 예외를 그대로 노출하지 말고,
- **해당 메서드/클래스의 역할에 맞는 예외로 번역(translation)** 해서 던지자.
- 단, 디버깅을 위해 **원인 예외(cause)는 반드시 함께 보존**하자. (예외 연쇄, exception chaining)


## 왜 추상화 수준에 맞는 예외가 중요할까

### 내부 구현 누출 문제
상위 메서드가 **자기보다 더 낮은 추상화의 예외를 그대로 던지면** 문제가 생긴다.
- 클라이언트가 **불필요하게 내부 구현에 의존**하게 됨.
  - 현재 구현이 DB에 의존해서 `SQLException`이 나오고, 그걸 그대로 던짐
  - 나중에 구현을 파일 기반으로 바꾸면 `IOException`이 나옴
  - -> **API가 변경되지 않았는데도** 호출 측 코드가 예외 타입 때문에 깨짐.
- 추상화 경계가 흐려짐
  - 이 메서드는 회원 저장이라는 추상적인 일을 하는데 왜 `SQLException`이 나올까?
  - **도메인/계층 경계가 예외 타입에서 다 새나온다.**

## 예외 번역(Exception Translation)

### 기본 패턴
하위 계층 예외를 **catch -> 상위 계층에 맞는 예외로 바꿔 던지는 패턴**

```java
public class RepositoryException extends RuntimeException {
    public RepositoryException(String message, Throwable cause) {
        super(message, cause); // 예외 연쇠
    }
}

public class MemberRepository {

    public Member findById(String id) {
        try {
            // 내부에서 JDBC등을 사용한다고 가정
            return queryFromDatabase(id);
        } catch (SQLException e) {
            // 추상화 수준에 맞는 예외로 번역
            throw new RepositoryException("Failed to find member : " + id, e);
        }
    }

    private Member queryFromDatabase(String id) throws SQLException {
        return null;
    }
}
```
- 호출자는 더 이상 `SQLException`을 신경 쓸 필요 없음.
- 이 레포지토리는 **저장소(Repository) 수준의 추상화**만 노출
  - 즉 "저장에 실패" / "조회에 실패" 같은 의미의 예외만 알면 됨.
- 디버깅 시에는 `cause`로 **원래** `SQLException`**까지 추적 가능** (스택트레이스에 다 보임)


## 예외 연쇄(Exception Chaining)
단순히 새 예외만 던지고 **원인 예외를 버리면** 디버깅 시에
- 왜 저장이 실패했지? -> 로그에는 `RepositoryException`만 있고
- 실제 원인이었던 `SQLException` 정보(에러 코드, SQL 상태 등)는 사라진다.

그래서 **예외 연쇄(Exception chaining)를 명시적**으로 권장
- 새 예외 생성 시 `cause`를 함께 넘김
  - ` throw new RepositoryException("Failed to find member : " + id, e);`
- 이렇게 하면
  - 스택 트레이스를 타고 내려가면 **근본 원인(root cause)** 까지 다 보인다.


## 정리
- 메서드는 **자기 추상화 수준에 어울리는 예외를 던져야 한다.**
- 하위 계층의 예외를 그대로 노출하면
  - 클라이언트가 내부 구현 세부사항에 의존하게 되고 추상화가 깨진다.
- **예외 번역(exception translation)을 사용해서 상위 수준의 예외로 바꿔 던지자.**
- 이때 원인 예외는 **예외 연쇄(exception chaining)** 로 함께 보존하자.