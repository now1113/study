:trophy: 이펙티브 자바 스터디 - 아이템 58

:book: 아이템 58: 전통적인 for 문보다는 for-each 문을 사용하라

## 핵심
- 가능하면 배열과 컬렉션 순회에 **향상된 for(`for (E e : elements)`)를 쓰자.**
- 이점: **보일러 플레이트 제거, 오프바이원/인덱스 오류 차단, 가독성 향상, 컬렉션/배열 모두 통일된 문법.**
- 내부적으로 컬렉션이면 `Iterator`, 배열이면 인덱스 순회를 **컴파일러가 생성**해준다.

## 기본 형태와 이점

### 전통적 for / iterator

```java
public void arrFor() {
    for (int i = 0; i < arr.length; i++) {
        process(arr[i]);
    }
}

public void iterator() {
    for (Iterator<Element> it = list.iterator(); it.hasNext(); ) {
        Element e = it.next();
        process(e.e);
    }
}
```

### 권장: for-each

```java
for (Element element : list) {
    process(element.e);
}

for (int i : arr) {
    process(i);
}
```
- 변수선언이 줄어들고, 의도가 바로 드러남.

### keySet + get

```java
for (Element element : map.keySet()) {
    Integer value = map.get(element);
    process(value);
}
```
- map.get(...)을 통해 불필요한 조회가 되므로 좋은 방법이 아님

### entrySet

```java
for (Map.Entry<Element, Integer> elementIntegerEntry : map.entrySet()) {
    process(elementIntegerEntry.getValue());
}
```
- 값만 필요하면 `map.values()`를, 키만 필요하면 `map.keySet()`을 바로 순회.

## for-each를 사용할 수 없는 상황

### 요소를 순회중 제거해야 할 때

```java
for (Element element : list) {
    if (element.e == 1) {
        list.remove(element);
    }
}
```
- ConcurrentModificationException이 발생한다

```java
for(Iterator<Element> it = list.iterator(); it.hasNext(); ) {
    if (it.next().e == 1) {
        it.remove();
    }
}

list.removeIf(e -> e.e == 1);
```
- `remove()` 혹은 `removeIf()`를 사용하자

### 리스트 요소를 인덱스로 갱신/치환해야 할 때

```java
List<String> lists = new ArrayList<>();
lists.add(" 안녕");
```

```java
for (String s : lists) {
    s = s.trim();
}
```
- 리스트에 반영 안 됨(지역 변수만 바뀜)

```java
for (int i = 0; i < lists.size(); i++) {
    lists.set(i, lists.get(i).trim());
}
```
- 인덱스 기반으로 실제 리스트에 반영

### 여러 컬렉션을 인덱스로 병렬 순회할 때

```java
for (int i = 0; i < a.size(); i++) {
    zip(a.get(i), b.get(i));
}
```

그 외 대부분은 for-each가 더 안전하고 깔끔하다.  
특히 **LinkedList**처럼 `get(i)`가 $O(n)$인 자료구조에서 전통적 인덱스 for는 비효율적일 수 있는데  
**for-each는 내부 iterator**로 안전하고 효율적으로 순회한다.


## 정리
- 단순 조회 -> **for-each**를 기본값으로.
- **제거/치환/병렬/부분구간**이면 전통적 for 또는 적절한 Iterator/ListIterator
- Map은 `entrySet()`을 우선, 값/키만 필요하면 `values()/keySet()`

> 순회가 목적이면 for-each, 인덱스/수정/병렬이 필요할 때만 정통적 for를 사용하자.