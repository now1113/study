:trophy: 이펙티브 자바 스터디 - 아이템 60

:book: 아이템 60: 정확한 답이 필요하다면 float와 double은 피하라

## 핵심
- `float`, `double`은 **이진 부동소수점**이라 0.1, 0.2같은 **10진 소수값을 정확히 표현하지 못한다.**
  - 누적 오차, 경계값 오류
- **돈, 포인트, 세금, 재고수량** 등 **정확성이 필요한 값**은 `BigDecimal` 또는 **정수(원 단위 long 등)로 처리.**
- 과학/센서/통계처럼 **근사치 허용**이면 `double` 사용해도 괜찮다.

## 왜 double이 위험한가
```java
System.out.println(0.1 + 0.2);      // 0.30000000000000004
System.out.println(1.00 - 0.90);    // 0.09999999999999998
System.out.println(1.03 - 0.41);    // 0.6200000000000001
```
- 결제/정산에서 소수점 한두 자리로 **합계 != 항목합**이 되는 이슈, **마지막 원 단위 흔들림, 경꼐 비교 실패**가 터진다.

## 해결

### 금액/포인트: 정수 또는 BigDecimal
- **KRW(원)**: 소수 없음 -> `long`(원 단위)
- 소수 필요(외화, 비율 계산, 부가세): `BigDecimal` + **명시적 반올림 규칙**

### BigDecimal 생성 규칙
- `new BigDecimal("0,1")` 또는 `BigDecimal.valueOf(0.1)` 사용.
- **절대** `new BigDecimal(0.1)`는 금지(이진 오차가 그대로 들어감)

```java
System.out.println(new BigDecimal("0.1"));  // 0.1
System.out.println(BigDecimal.valueOf(0.1));    // 0.1
System.out.println(new BigDecimal(0.1));    // 0.1000000000000000055511151231257827021181583404541015625
```

### 반올림, 스케일
- 나눗셈, 퍼센트에는 **항상 RoundingMode 지정**
- `setScale(0, HALF_UP)`로 원 단위 반올림, 부가세 정책에 따라 `FLOOR`(절사) / `CEILING`(올림) 등 명시

```java
BigDecimal vatRate = new BigDecimal("0.1");
BigDecimal price = new BigDecimal("19900");

BigDecimal vat = price.multiply(vatRate).setScale(0, RoundingMode.HALF_UP);// 1,990
```

### 비교 시 주의사항 (equals vs compareTo)
- `equals`는 **스케일까지 비교**: `0.10` != `0.1`
- 금액 동등 비교는 `compareTo` 사용

```java
System.out.println(new BigDecimal("0.10").equals(new BigDecimal("0.1"))); // false
System.out.println(new BigDecimal("0.10").compareTo(new BigDecimal("0.1")) == 0); // true
```

## 언제 double을 사용해도 괜찮을까
- **근사 허용**: 물리 측정값, 통계 평균, 머신러닝 특징량 등.
- 이 경우에도 표시, 판단 경계(임계치 비교)는 **epsilon 허용오차**로 비교

```java
boolean nearlyEqual(double a, double b, double eps) {
    return Math.abs(a - b) < eps;
}
```

## 요약
- 돈/포인트/세금/재고 등 정확한 계산 -> **정수 또는** `BigDecimal` + **명시적 반올림.**
- `BigDecimal`은 **생성, 비교, 나눗셈** 규칙만 지키면 안전하다.
- **성능**은 정수(Long, minor unit)로 모델링하고, **비율 계산만 BigDecimal**을 거쳐 **정책적으로 라운딩**하자.
