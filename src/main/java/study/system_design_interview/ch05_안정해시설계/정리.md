# 안정 해시 (Consistent Hashing)

## 왜 필요한가

전통적 분배(hash(key) % N)는 서버 수가 바뀌면 대부분의 키가 재배치됨 → 캐시 적중률 급락, 대규모 데이터 이동.  
안정 해시는 “서버 증감 시 이동하는 키를 최소화”하는 게 핵심 목표.

## 원형 해시 링

해시 공간을 원(ring) 으로 보고, 서버와 키를 모두 링 위의 점으로 매핑한다.  
매핑 규칙: 키의 위치에서 시계 방향으로 가장 가까운 서버가 그 키를 담당한다.

### 서버 추가/삭제 시 무슨 일이 생기는 일

- 서버 추가: 새 서버가 링 어딘가에 들어오면, 그 지점 이전 서버와 새 서버 사이 구간에 있던 키만 새 서버로 이동한다.
  - 전체 키 중 일부만 이동 (대략 새 서버가 차지하는 구간 비율만큼).

- 서버 삭제(장애): 삭제된 서버가 담당하던 구간의 키는 다음 서버가 대신 맡는다.
  - 역시 그 구간의 키만 이동.

## 가상 노드(Virtual Nodes)

실제 서버 1대를 링에 여러 점(가상 노드) 으로 반복 배치한다. (예: A#1, A#2, ...)

### 왜 필요한가

- 서버가 링에서 차지하는 구간 길이가 편차를 보이면 부하가 쏠림.
- 여러 지점에 고르게 흩뿌려 놓으면 키 분포가 더 균등해진다.

### 효과

- 핫스팟 완화, 서버 성능 차이가 있으면 가상 노드 개수로 가중치도 줄 수 있다.


